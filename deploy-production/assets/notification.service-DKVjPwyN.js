import{s as e,t}from"./index-BEextJzm.js";const r={async createNotification(r){try{const{userId:i,title:s,message:a,type:o,priority:n="medium",sendSMS:c=!1,phoneNumber:u}=r,{data:d,error:f}=await e.from("notifications").insert({user_id:i,title:s,message:a,type:o,priority:n,read:!1}).select().single();if(f)throw f;return c&&u&&await t.sendSms({to:t.formatPhoneNumber(u),message:`ABAN_COOL: ${s} - ${a}`}),{success:!0,message:"Notification created successfully",notificationId:d.id}}catch(i){return{success:!1,message:i.message||"Failed to create notification"}}},async sendTransactionNotification(e,t,r,i){const s=`Transaction ${t}`,a=`Your ${t} of KES ${r.toLocaleString()} has been processed successfully.`;return this.createNotification({userId:e,title:s,message:a,type:"transaction",priority:"high",sendSMS:!0,phoneNumber:i})},async sendKYCNotification(e,t,r){return this.createNotification({userId:e,title:`KYC ${t.charAt(0).toUpperCase()+t.slice(1)}`,message:{approved:"Your KYC verification has been approved. You now have full access to all features.",rejected:"Your KYC verification was rejected. Please review and resubmit your documents.",pending:"Your KYC verification is under review. We'll notify you once it's processed."}[t],type:"kyc",priority:"high",sendSMS:!0,phoneNumber:r})},async sendSecurityAlert(e,t,r){return this.createNotification({userId:e,title:"Security Alert",message:t,type:"security",priority:"urgent",sendSMS:!0,phoneNumber:r})},async markAsRead(t){try{const{error:r}=await e.from("notifications").update({read:!0}).eq("id",t);return!r}catch(r){return!1}},async markAllAsRead(t){try{const{error:r}=await e.from("notifications").update({read:!0}).eq("user_id",t).eq("read",!1);return!r}catch(r){return!1}},async getUnreadCount(t){try{const{count:r,error:i}=await e.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("read",!1);return r||0}catch(r){return 0}},async getUserNotifications(t,r=50){try{const{data:i,error:s}=await e.from("notifications").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(r);if(s)throw s;return i||[]}catch(i){return[]}}};export{r as notificationService};
